# Brick Breaker Game Development Log

This file tracks the features and changes requested for the p5.js Brick Breaker game.

## Internal Naming Conventions

To ensure clear communication, here are the internal names for various game elements:

*   **Ball Types:**
    *   `explosive`: Yellow ball with red glow, power-up creates an explosion.
    *   `piercing`: Yellow ball, power-up lets it fly through a set number of bricks.
    *   `split`: Yellow ball, power-up splits it into three.
    *   `brick`: Yellow ball, power-up spawns a ring of bricks.
    *   `giant`: A large, purple, consumable ball that pierces all bricks.

*   **Brick Types:**
    *   `normal`: The standard, upgradeable brick. Can host overlays.
    *   `goal`: Yellow brick. All goal bricks must be destroyed to clear the level.
    *   `extraBall`: Green brick that grants an extra ball when destroyed.
    *   `explosive`: Orange brick that explodes when destroyed.
    *   `horizontalStripe` / `verticalStripe`: Red bricks that clear their row/column when destroyed.

*   **Brick Overlays:** (Applied to `normal` bricks)
    *   `builder`: Light blue `+` aura. Spawns/buffs bricks at the end of a turn.
    *   `healer`: Light green circular aura. Heals nearby bricks at the end of a turn.
    *   `mine`: Red circular aura. Explodes when hit by the ball.

*   **Game States:**
    *   `aiming`: Player is aiming the ball.
    *   `playing`: Ball is in motion.
    *   `levelClearing`: All goal bricks are gone, waiting for the ball to die to proceed.
    *   `levelComplete`: Level is won, awaiting player input to start the next.
    *   `gameOver`: All balls are lost, awaiting player input to restart.

---

## Request Log (Latest First)

### Date: 2024-08-07

**Features & Changes:**

1.  **Gameplay & Balancing:**
    *   **PiercingBall Rebalance:** This ball has been significantly changed to create a high-risk, high-reward playstyle.
        *   **During Power-up:** The ball is now completely intangible. It phases through bricks without dealing damage and without incrementing the combo, acting as a purely strategic move.
        *   **Normal State:** When *not* using its power-up, the ball now takes 2 damage for every brick it hits. This makes it a fragile ball that requires careful aim to preserve.
    *   **BrickBall Enhancement:** The `BrickBall`'s power-up can now destroy and replace `normal` bricks even if they have a `Builder`, `Healer`, or `Mine` overlay, increasing its utility.

2.  **Visual Fixes:**
    *   **ExplosiveBall Visuals:** The special visuals for the `ExplosiveBall` (its pulsating red glow and orange outline) now correctly disappear once all of its power-up uses have been consumed, making it consistent with other ball types.

### Date: 2024-08-06

**Features & Changes:**

1.  **Gameplay & Balancing:**
    *   **Ball Size:** The four standard ball types (`explosive`, `piercing`, `split`, `brick`) have been made 20% smaller for better maneuverability.
    *   **SplitBall Combo:** The small balls generated by the `SplitBall`'s power-up now correctly contribute to the main combo counter.
    *   **Smarter Game Over:** The game over condition is now more forgiving. The game will only end if the player is out of regular balls, has no `GiantBall`s left, AND cannot afford to purchase a new ball from the shop.

2.  **Game Logic & VFX:**
    *   **Builder/Healer Stacking:** The effects of `Builder` and `Healer` bricks now stack. A brick buffed by multiple Builders will receive a multiplied health bonus. A new brick spawned on a tile targeted by multiple builders will be created with multiplied health. Healers also stack their healing effect on a single target.
    *   **BrickBall Power-up Fix:** The `BrickBall`'s power-up ability now correctly destroys any bricks it replaces, ensuring their on-death effects (explosions, coin drops, etc.) are triggered before the new bricks are spawned.
    *   **StripeBrick Visuals:** The arrows on `StripeBrick`s have been inverted to point outwards, more clearly indicating the direction of the blast.

### Date: 2024-08-05

**Features & Changes:**

1.  **VFX & Visuals Overhaul:**
    *   **Explosion VFX:** The explosion effect (from `ExplosiveBall` and `ExplosiveBrick`) has been reworked. It now starts at full size, with its border growing thicker as it fades out for a more impactful feel.
    *   **Stripe Brick VFX:** The line-clearing effect for `StripeBrick` no longer uses a generic white flash. It now shoots a burst of fast-moving particles in the direction of the line clear.
    *   **ExplosiveBall Visuals:** The `ExplosiveBall` is now a vibrant yellow ball with a pulsating red outer glow.
    *   **StripeBrick Visuals:** `StripeBrick`s are now red with white, elevator-style arrows indicating their clear direction, improving readability.

2.  **UI Improvements:**
    *   The "Giant: X" stat has been removed from the top-left UI for a cleaner look.
    *   The `GiantBall` button in the ball selector UI is now completely hidden if the player has zero giant balls.
    *   When giant balls are awarded from a high combo, a "+N Giant Ball" text now appears below the main combo announcement to provide clear feedback.

3.  **Game Logic Tuning:**
    *   **Level Generation:** Bricks designated to be `Builder` or `Healer` hosts are now also eligible to receive extra HP from the level's HP Pool, making them more resilient.

4.  **Documentation:**
    *   Added a new "Internal Naming Conventions" section to this README to standardize terms for game elements.

### Date: 2024-08-02

**Features & Changes:**

1.  **New Combo & Bonus System:**
    *   **Combo Counter:** A combo counter increases with every brick hit by the main ball or destroyed by any means. It resets to 0 if the main ball hits a wall.
    *   **End-of-Turn Bonuses:** The highest combo achieved in a turn determines the rewards spawned for the next turn.
    *   **VFX:** Added combo counter VFX and a special announcement effect for the max combo achieved.

2.  **Combo Rewards (Tiered System):**
    *   **Mine Overlay (Combo 1-15):** For every 3 combo points, a "Mine" overlay is placed on a random existing brick. When the host brick is hit, it creates a 10-damage explosion to its 8 neighbors.
    *   **Stripe Bricks (Combo 1-60):** For every 15 combo points, a new `StripeBrick` (Horizontal or Vertical, 10 HP) is spawned in an empty space. When destroyed, it deals 30 damage to its entire row or column.
    *   **Giant Ball (Combo 50+):** For every 50 combo points (no limit), the player is awarded one consumable `GiantBall`.

3.  **New Ball Type: Giant Ball (Consumable):**
    *   A new UI element tracks the number of Giant Balls available.
    *   Using a Giant Ball does not consume a regular ball from the player's stock.
    *   **Behavior:** It's a larger, slower ball that moves through bricks (does not bounce), dealing 1000 damage to each brick it touches. It has a fixed 10 HP and is destroyed upon hitting the first wall.
    *   **Limitation:** Turns where a Giant Ball is used do not generate combos or combo bonuses.

4.  **Balancing and UI:**
    *   Builder overlay spawn cost increased to 100 HP Pool.
    *   Healer overlay spawn cost increased to 80 HP Pool.
    *   Default spawn chance for both changed to 3%.
    *   Their inputs in the Level Settings are now number fields instead of sliders for easier input.

### Date: 2024-08-01

**Features & Changes:**

1.  **New Brick Overlay: Builder**
    *   **Visual:** A `(+)` shaped aura on top of a normal brick. Dies if the host brick is destroyed.
    *   **Behavior:** At the end of each turn, the Builder spawns four 10-HP bricks in the nearest available adjacent spots. If a direction is blocked, it will build past the obstruction. If a direction is fully blocked to the edge, it will grant +10 HP to the last brick in that line instead.
    *   **VFX:** Added a visual effect for the building action.

2.  **New Brick Overlay: Healer**
    *   **Visual:** A circular aura on top of a normal brick. Dies with the host.
    *   **Behavior:** At the end of each turn, the Healer restores 10 HP to all 8 surrounding non-special bricks.
    *   **VFX:** Added a visual effect for the healing action.

3.  **Updated Level Generation for Overlays:**
    *   Added `BuilderBrickChance` and `HealerBrickChance` (default 5% each) to the Level Generation Settings.
    *   During the HP distribution phase of level generation, a normal brick has a chance to become a Builder or Healer host instead of gaining HP. This conversion costs 50 HP from the level's HP Pool.

4.  **Responsive In-Game UI Redesign:**
    *   The Ball Health Bar and Power-Up counter are now drawn where the Ball Selector UI appears (bottom-center for portrait, mid-left for landscape).
    *   The number of health segments per row is no longer fixed at 10 but adapts dynamically to the available screen width.

### Date: 2024-07-31

**Features & Changes:**

1.  **Project `README.md`:**
    *   This file was created to log the context of development requests moving forward.

2.  **Level Generation Overhaul:**
    *   **Creative Formulas:** Added new procedural generation algorithms to the "Formulaic" pattern pool to create more varied and interesting brick layouts, including:
        *   Circles
        *   Triangles (isosceles)
        *   Rotated Rectangles
        *   Polygons/Stars
    *   **Strict Brick & HP Distribution Logic:**
        *   The generation process now strictly adheres to the specified brick count and HP pool.
        *   Goal Bricks and +1 Ball Bricks are placed first and do not count towards the level's `brickCount`.
        *   The engine places 10-HP bricks until the `brickCount` is met, generating new formulaic shapes if the previous one runs out of space.
        *   After the target brick count is reached, any remaining HP from the `HPPool` is distributed among the placed normal bricks, increasing their health.
    *   **Updated Default Balancing:**
        *   Starting Bricks: `20`
        *   Bricks per Level: `10`
        *   Max Bricks: `300`
        *   Starting HP Pool: `100`
        *   HP Pool per Level: `80`
        *   HP Multiplier/Lvl: `1.05`
    *   **New "Few Brick Layout" Feature:**
        *   Added a "FewBrickLayoutChance" parameter to Level Settings (default 10%).
        *   When triggered, the level generates with only 20% of the normal brick count, but with the full HP pool distributed among them, creating rare and difficult levels with very tough bricks.

3.  **UI Redesign: In-Canvas Health Bar & Power-Up Counter:**
    *   The HTML-based health bar and power-up indicator have been removed.
    *   These UI elements are now drawn directly onto the p5.js canvas.
    *   They are located in the bottom-left of the game area.
    *   The health bar's segments now visually represent partial health (e.g., a half-filled segment for 5 HP).
    *   The bar supports high HP values by wrapping into multiple rows, with a maximum of 10 segments per row, stacking from the bottom-up.